
# RPG Кузница Приключений - Информация об Игре

Добро пожаловать в "RPG Кузницу Приключений"! Эта игра представляет собой динамичную текстовую RPG, управляемую искусственным интеллектом Gemini. Здесь вы можете создавать уникальных персонажей и отправляться в захватывающие приключения, сюжет которых формируется на основе ваших действий и решений.

## Содержание
1.  [Обзор Игры](#обзор-игры)
2.  [Создание Персонажа](#создание-персонажа)
    *   [Шаг 1: Основы Персонажа (Имя, NSFW, Модель ИИ и API-ключ)](#шаг-1-основы-персонажа-имя-nsfw-модель-ии-и-api-ключ)
    *   [Шаг 2: Настройка Мира](#шаг-2-настройка-мира)
    *   [Шаг 3: Выбор Расы](#шаг-3-выбор-расы)
    *   [Шаг 4: Выбор Класса](#шаг-4-выбор-класса)
    *   [Шаг 5: Предыстория](#шаг-5-предыстория)
    *   [Шаг 6: Анализ Предыстории ИИ](#шаг-6-анализ-предыстории-ии)
    *   [Шаг 7: Ручная Корректировка Характеристик](#шаг-7-ручная-корректировка-характеристик)
    *   [Шаг 8: Обзор и Завершение](#шаг-8-обзор-и-завершение)
3.  [Игровой Процесс](#игровой-процесс)
    *   [Интерфейс Чата](#интерфейс-чата)
    *   [Искусственный Интеллект (Мастер Игры)](#искусственный-интеллект-мастер-игры)
    *   [Команды ИИ для Интерфейса](#команды-ии-для-интерфейса)
    *   [Система Бросков Кубиков](#система-бросков-кубиков)
    *   [Система Опыта и Уровней](#система-опыта-и-уровней)
4.  [Пользовательский Интерфейс (Панели)](#пользовательский-интерфейс-панели)
    *   [Панель Информации об Игроке](#панель-информации-об-игроке)
    *   [Панель Фокуса](#панель-фокуса)
    *   [Панель Дневника Мира](#панель-дневника-мира)
5.  [Атрибуты и Данные Персонажа](#атрибуты-и-данные-персонажа)
    *   [Характеристики (Stats)](#характеристики-stats)
    *   [Расы](#расы)
    *   [Классы](#классы)
    *   [Навыки (Skills)](#навыки-skills)
    *   [Здоровье (HP)](#здоровье-hp)
    *   [Опыт (XP) и Уровень](#опыт-xp-и-уровень)
    *   [Статусы](#статусы)
    *   [Элементы Мира](#элементы-мира)
6.  [Технические Аспекты](#технические-аспекты)
    *   [Интеграция с Gemini AI](#интеграция-с-gemini-ai)
    *   [API-ключ](#api-ключ)
    *   [Отладочное Меню](#отладочное-меню)

## Обзор Игры

"RPG Кузница Приключений" — это текстовая ролевая игра, где игрок взаимодействует с Мастером Игры (DM), роль которого выполняет ИИ Gemini. Основная цель — погрузиться в историю, развивать своего персонажа и влиять на мир своими решениями. Игра поддерживает как стандартные фэнтезийные миры, так и полностью кастомные, созданные игроком, с возможностью генерации уникальных рас и классов ИИ.

Опциональный режим **NSFW (18+)** позволяет создавать контент для взрослых, включая откровенные сцены, если игрок этого желает.

## Создание Персонажа

Процесс создания персонажа состоит из нескольких шагов, позволяющих детально настроить вашего героя.

### Шаг 1: Основы Персонажа (Имя, NSFW, Модель ИИ и API-ключ)
*   **Имя Персонажа:** Выберите имя для вашего героя.
*   **Режим 18+ (NSFW):** Переключатель для активации контента для взрослых. По умолчанию выключен.
*   **Выбор Модели ИИ:** Выберите модель ИИ Gemini, которая будет управлять игрой. Доступные модели перечислены с их описаниями.
*   **API-ключ Gemini:**
    *   Если переменная окружения `API_KEY` не установлена или недействительна, в этом разделе появится поле для ручного ввода API-ключа.
    *   Вы можете ввести свой ключ и нажать "Применить Ключ". Это активирует функции ИИ на время текущей сессии.
    *   Если API-ключ уже успешно загружен из переменных окружения, поле для ручного ввода не отображается.
    *   **Важно:** Без активного API-ключа (из окружения или введенного вручную) функции ИИ будут недоступны, и выбор модели ИИ будет заблокирован.

### Шаг 2: Настройка Мира
*   **Стандартный Фэнтези-Мир:** Классический фэнтезийный мир. Используются стандартные расы и классы.
*   **Создать Собственный Мир:** Позволяет игроку описать свой уникальный мир.
    *   **Описание Мира:** Поле для ввода деталей вашего сеттинга.
    *   **Расы и Классы:** Можно использовать стандартные или сгенерировать новые с помощью ИИ (если API-ключ активен) на основе описания мира. Сгенерированные ИИ расы/классы имеют однословные названия и не имеют предопределенных модификаторов.

### Шаг 3: Выбор Расы
Выберите расу (стандартную или сгенерированную ИИ, в зависимости от настроек Шага 2).

### Шаг 4: Выбор Класса
Выберите класс (стандартный или сгенерированный ИИ).

### Шаг 5: Предыстория
Напишите предысторию вашего персонажа. Она будет проанализирована ИИ (если API-ключ активен) для генерации предложений.

### Шаг 6: Анализ Предыстории ИИ
*   Если API-ключ активен, ИИ анализирует предысторию и предлагает:
    *   Модификаторы характеристик.
    *   Уникальные сюжетные зацепки/детали мира.
    *   2-3 уникальных навыка.
*   Эти предложения автоматически применяются. Если ключ неактивен, этот шаг предложит стандартные значения или уведомит об отключенном ИИ.

### Шаг 7: Ручная Корректировка Характеристик
Вы можете вручную изменить характеристики в пределах установленного бюджета очков (`MANUAL_POINTS_POOL`, по умолчанию ±6) от значений, рассчитанных после Шага 6. Есть опция "Режим Бога" для снятия этого ограничения. Минимальное значение характеристики — 3.

### Шаг 8: Обзор и Завершение
Просмотрите все данные персонажа. Начальное здоровье (HP) рассчитывается от Телосложения. Персонаж начинает с 1-го уровня и 0 XP. Нажмите "Начать приключение!".

## Игровой Процесс

### Интерфейс Чата
Основное взаимодействие с игрой. Игрок вводит действия, ИИ (DM) описывает мир и результаты. Системные сообщения информируют о событиях (XP, броски). Есть кнопка регенерации ответа ИИ.

### Искусственный Интеллект (Мастер Игры)
ИИ Gemini выступает в роли DM, получая системные инструкции о персонаже, мире, режиме NSFW, правилах ответов и командах.

### Команды ИИ для Интерфейса
ИИ использует команды в конце сообщений для управления игрой (невидимы игроку):
*   **`FOCUS_PANEL_UPDATE::{JSON}`:** Обновляет "Панель Фокуса" (NPC/объект).
*   **`PLAYER_HP_UPDATE::{JSON}`:** Обновляет HP игрока.
*   **`PLAYER_STATUS_UPDATE::{JSON}`:** Обновляет статусы игрока.
*   **`DICE_ROLL_REQUEST::{JSON}`:** Запрашивает бросок кубика.
*   **`AWARD_XP::{JSON}`:** Награждает опытом.
*   **`AWARD_ITEM::{JSON}`:** Награждает предметом.
*   **`CONSUME_ITEM::{JSON}`:** Использует/удаляет предмет.
*   **`LEVEL_UP_INITIATE::{JSON}`:** Инициирует повышение уровня.

### Система Бросков Кубиков
*   ИИ запрашивает бросок для действий с неопределенным исходом.
*   В интерфейсе `DiceRoller.tsx` игрок видит описание и характеристики.
*   Бросается D20, добавляется модификатор характеристики (`Math.floor((Значение - 10) / 2)`).
*   Результат отправляется ИИ, который описывает исход.

### Система Опыта и Уровней
*   XP начисляется командой `AWARD_XP`.
*   Пороги XP (`XP_THRESHOLDS`) определяют необходимое количество для каждого уровня.
*   При достижении порога (или по команде `LEVEL_UP_INITIATE`) открывается модальное окно `LevelUpModal.tsx`:
    1.  **HP:** Увеличивается на `BASE_HP_GAIN_PER_LEVEL` (8) + новый модификатор Телосложения. Восстанавливается до максимума.
    2.  **Характеристика:** Игрок выбирает одну для увеличения на +1.
    3.  **Способность (если API-ключ активен):** ИИ предлагает 3 варианта, игрок выбирает одну.
*   Обновляются данные персонажа, избыточный XP переносится. Сессия чата с ИИ переинициализируется.

## Пользовательский Интерфейс (Панели)

Справа (десктоп) или через иконки-гамбургеры (мобильные, планируется) отображаются панели:

### Панель Информации об Игроке (`PlayerInfoPanel.tsx`)
Имя, раса, класс, уровень, HP, XP, характеристики, навыки, статусы, инвентарь, режим NSFW.

### Панель Фокуса (`FocusInfoPanel.tsx`)
Информация о текущем NPC/существе в фокусе (имя, тип, HP, статус, описание).

### Панель Дневника Мира (`WorldLogPanel.tsx`)
Ключевые элементы мира из предыстории/игры. Задания (пока заглушка).

## Атрибуты и Данные Персонажа

### Характеристики (Stats)
Сила, Ловкость, Телосложение, Интеллект, Мудрость, Харизма.

### Расы
Стандартные (Человек, Эльф, Дворф, Орк) или сгенерированные ИИ.

### Классы
Стандартные (Воин, Маг, Плут, Следопыт) или сгенерированные ИИ.

### Навыки (Skills)
Предлагаются ИИ из предыстории или при повышении уровня. Состоят из названия и описания.

### Здоровье (HP)
Очки здоровья.

### Опыт (XP) и Уровень
Механика прогрессии персонажа.

### Статусы
Временные состояния (например, "Отравлен").

### Элементы Мира
Уникальные детали мира для сюжета.

## Технические Аспекты

### Интеграция с Gemini AI
Используется API Google Gemini. Модель `gemini-2.0-flash` (или выбранная пользователем).

### API-ключ
*   **Основной способ:** Ключ **должен** быть установлен как переменная окружения `API_KEY`.
*   **Запасной способ:** Если переменная окружения `API_KEY` не найдена или недействительна, при создании персонажа (на Шаге 1, в разделе выбора модели ИИ) пользователь может **вручную ввести API-ключ**. Этот ключ будет использоваться **только для текущей сессии** и не сохраняется постоянно в приложении.
*   Приложение **не предоставляет** интерфейса для долговременного управления ключом.
*   Если ключ отсутствует или невалиден (ни из окружения, ни введенный вручную), функции ИИ будут отключены или ограничены.
*   **Предупреждение о безопасности:** Встраивание API-ключей непосредственно в клиентский код или их передача способом, который может сделать их видимыми в браузере, не является безопасной практикой для производственных приложений с ключами, имеющими широкие права доступа. Для личных или демонстрационных проектов с ограниченными ключами это может быть приемлемо, но вы должны осознавать риски. Рекомендуется использовать бэкенд-прокси для вызовов API в публичных приложениях.

### Отладочное Меню (`DebugMenu.tsx`)
Доступно по иконке шестеренки в режиме игры.
*   **Симулировать Level Up:** Принудительно инициирует повышение уровня.
*   **Токены ответа ИИ:** Отображает количество токенов, использованных в последнем ответе ИИ.
